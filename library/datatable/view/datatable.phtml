
<?php echo $this->_css; ?>
<style>

    div.innerDetails { display: none }

    #tableau-<?php echo $this->name ?> td {
        overflow: hidden; /* this is what fixes the expansion */
        white-space: normal;
        word-wrap: break-word;
        max-width: 400px;


    }
    thead input { width: 100% }
    input.search_init { color: #999;font-size : 11px; }

    select.select_filter {max-width: 100px;font-size : 11px;}



    #tableau-<?php echo $this->name ?> table { width: 100%;}

    #tableau-<?php echo $this->name ?> table a { text-decoration: underline; }
    #tableau-<?php echo $this->name ?> table tr  >  td { border: 0px;text-align: left;vertical-align: top;  }
    #tableau-<?php echo $this->name ?> table tr  >  td:first-child {  padding-left: 50px;width: 100px;font-weight: bold;  }
    #tableau-<?php echo $this->name ?> table  >  tbody {
        border-top: 0px dotted #333333;
    }
    #tableau-<?php echo $this->name ?> table  >  tbody tr:hover {
        background-color: #4A9DD7;
        color: #FFF;
    }
    #tableau-<?php echo $this->name ?> tbody tr.even, #tableau-<?php echo $this->name ?> tbody tr.odd,
    #tableau-<?php echo $this->name ?> tbody tr.even td a, #tableau-<?php echo $this->name ?> tbody tr.odd td a{
        color: #000;

    }
    #tableau-<?php echo $this->name ?> tbody tr.even:hover, #tableau-<?php echo $this->name ?> > tbody tr.even td.highlighted {
        background-color: #117ECA;
        color: #FFF;
    }

    #tableau-<?php echo $this->name ?> tbody tr.even:hover > td >  a, #tableau-<?php echo $this->name ?> > tbody tr.even td.highlighted > a {
        color: #FFF;
    }


    #tableau-<?php echo $this->name ?> tbody tr.odd:hover, #tableau-<?php echo $this->name ?> > tbody tr.odd td.highlighted {
        background-color: #117ECA;
        color: #FFF;
    }

    #tableau-<?php echo $this->name ?> tbody tr.odd:hover > td > a, #tableau-<?php echo $this->name ?> > tbody tr.odd td.highlighted > a {
        color: #FFF;
    }


    #tableau-<?php echo $this->name ?> tr.even:hover {
        background-color: #117ECA;
        color: #FFF;
    }

    #tableau-<?php echo $this->name ?> tr.even:hover > td.sorting_1 {
        background-color: #117ECA;
        color: #FFF;
    }

    #tableau-<?php echo $this->name ?> tr.even:hover > td.sorting_2 {
        background-color: #117ECA;
        color: #FFF;
    }

    #tableau-<?php echo $this->name ?> tr.even:hover > td.sorting_3 {
        background-color: #E2FF89;
        color: #FFF;
    }

    #tableau-<?php echo $this->name ?> tr.odd:hover {
        background-color: #117ECA;
        color: #FFF;
    }

    #tableau-<?php echo $this->name ?> tr.odd:hover > td.sorting_1 {
        background-color: #117ECA;
        color: #FFF;
    }

    #tableau-<?php echo $this->name ?> tr.odd:hover > td.sorting_2 {
        background-color: #117ECA;
        color: #FFF;
    }

    #tableau-<?php echo $this->name ?> tr.odd:hover > td.sorting_3 {
        background-color: #117ECA;
        color: #FFF;
    }

    .ColVis {
        float: left;
        margin-bottom: 0
    }

    img.detail, img.ajax-click-load {
        cursor: pointer;
    }

    .loading-overlay {
        background: rgba(0,0,0,0.6);
        position:absolute;
        width:100%;
        height:100%;
        z-index:100
    }

    /* LOADING SPINNER*/
    .circle {
        background-color: rgba(0,0,0,0);
        border:5px solid rgba(0,183,229,0.9);
        opacity:.9;
        border-right:5px solid rgba(0,0,0,0);
        border-left:5px solid rgba(0,0,0,0);
        border-radius:50px;
        box-shadow: 0 0 35px #2187e7;
        width:50px;
        height:50px;
        margin:0 auto;
        -moz-animation:spinPulse 1s infinite ease-in-out;
        -webkit-animation:spinPulse 1s infinite linear;
    }
    .circle1 {
        background-color: rgba(0,0,0,0);
        border:5px solid rgba(0,183,229,0.9);
        opacity:.9;
        border-left:5px solid rgba(0,0,0,0);
        border-right:5px solid rgba(0,0,0,0);
        border-radius:50px;
        box-shadow: 0 0 15px #2187e7; 
        width:30px;
        height:30px;
        margin:0 auto;
        position:relative;
        top:-50px;
        -moz-animation:spinoffPulse 1s infinite linear;
        -webkit-animation:spinoffPulse 1s infinite linear;
    }
    @-moz-keyframes spinPulse {
        0% { -moz-transform:rotate(160deg); opacity:0; box-shadow:0 0 1px #2187e7;}
    50% { -moz-transform:rotate(145deg); opacity:1; }
    100% { -moz-transform:rotate(-320deg); opacity:0; }
    }
    @-moz-keyframes spinoffPulse {
        0% { -moz-transform:rotate(0deg); }
    100% { -moz-transform:rotate(360deg);  }
    }
    @-webkit-keyframes spinPulse {
        0% { -webkit-transform:rotate(160deg); opacity:0; box-shadow:0 0 1px #2187e7; }
    50% { -webkit-transform:rotate(145deg); opacity:1;}
    100% { -webkit-transform:rotate(-320deg); opacity:0; }
    }
    @-webkit-keyframes spinoffPulse {
        0% { -webkit-transform:rotate(0deg); }
    100% { -webkit-transform:rotate(360deg); }
    }



    .ColVis_Button {
        height: 24px;
    }


    div.ColVis_collection button.ColVis_Button {
        height: 34px;
    }

    #tableau-<?php echo $this->name ?>_length, #tableau-<?php echo $this->name ?>_filter {
        clear: right;
    }

    #tableau-<?php echo $this->name ?>_processing {
        border : 0px;
    }

    #tableau-<?php echo $this->name ?>_filter {
        float:right;
    }

    div.DTTT_container {
        float: right;
    }


    .dataTables_length {
        width: auto;
    }

    tfoot th input { width: 90% }


</style>



<h1><?php echo $this->config["table"]["title"] ?></h1>

<?php echo $this->_beforeTableHTML; ?>

<table cellpadding="0" width="100%" cellspacing="0" border="0" class="display" style="margin-top:0px;" class="shin-datatable" id="tableau-<?php echo $this->name ?>">
    <thead>
        <tr>
            <?php
            $details = "";
            $filterIndividualColumn = null;
            $filterIndividualColumnShow = false;

            if (isset($this->config["table"]["detail"]) && $this->config["table"]["detail"]) {
                $filterIndividualColumn .= '<td></td>';
                ?>
                <th></th>
                <?php
            }

            $keyAjust = 0;

            if (isset($this->config["table"]["detail"]) && $this->config["table"]["detail"])
                $keyAjust--;

            foreach ($this->config["columns"] as $key => $column) {
                if ((!isset($column["show_detail"]) || !$column["show_detail"])
                        && (!isset($column["show"]) || !$column["show"])
                ) {
                    $keyAjust++;
                }

                if (isset($this->config["table"]["detail"]) && $this->config["table"]["detail"]
                        && isset($column["show_detail"]) && $column["show_detail"]
                ) {
                    $details[] = $column["title"] . "|" . ($key - $keyAjust);
                }

                if (isset($column["show"]) && $column["show"]
                        || isset($column["show_detail"]) && $column["show_detail"]
                ) {
                    $filterIndividualColumn .= '<td>';
                    ?>

                    <th  class="
                    <?php echo isset($column["editable"]) && $column["editable"] ? "editable" : ""; ?>
                    <?php echo isset($column["editable_field"]) ? "editable-" . $column["editable_field"] : ""; ?>
                    <?php echo isset($column["nl2br"]) ? "editable-br2nl" : ""; ?>
                         " width="25%"><?php echo $column["title"]; ?></th>

                    <?php
                    if (isset($column["filter_field"]) && $column["filter_field"]) {
                        $filterIndividualColumnShow = true;
                        $filterIndividualColumn .= '<input style="width:100%;" type="text" name="search_' . $column["name"] . '" value="Recherche par ' . $column["title"] . '" class="search_init" />';
                    }
                    ?>



                    <?php
                    $filterIndividualColumn .= '</td>';
                }
            }
            if (isset($this->config["extra"]["deletable"]) && $this->config["extra"]["deletable"]) {
                $filterIndividualColumn .= '<td></td>';
                ?>
                <th></th>
                <?php
            }
            ?>
            
        </tr>

        <?php
        if ($filterIndividualColumnShow && 0) {
            ?>
            <tr><?php echo $filterIndividualColumn; ?></tr>
            <?php
        }
        ?>

    </thead>
    <tbody>

    </tbody>
    <tfoot>
        <tr>
            <?php
            if (isset($this->config["table"]["detail"]) && $this->config["table"]["detail"]) {
                $filterIndividualColumn .= '<td></td>';
                ?>
                <th></th>
                <?php
            }

            foreach ($this->config["columns"] as $column) {
                if (isset($column["show"]) && $column["show"] || isset($column["show_detail"]) && $column["show_detail"]) {
                    ?>
                    <th width="25%"><?php echo $column["title"]; ?></th>
                    <?php
                }
            }
            
            if (isset($this->config["extra"]["deletable"]) && $this->config["extra"]["deletable"]) {
                ?>
                <th></th>
                <?php
            }
            ?>

        </tr>


        <!-- TOTAL DU BAS -->
        <tr>
            <?php
            if (isset($this->config["table"]["detail"]) && $this->config["table"]["detail"]) {
                ?>
                <th style="background-color:#fff;"></th>
                <?php
            }

            foreach ($this->config["columns"] as $column) {
                if (isset($column["show"]) && $column["show"] || isset($column["show_detail"]) && $column["show_detail"]) {
                    ?>
                    <th style="background-color:#fff; height:30px; font-size:14px; text-align:center; padding:3px 0; "></th>
                    <?php
                }
            }
            if (isset($this->config["extra"]["deletable"]) && $this->config["extra"]["deletable"]) {
                ?>
                <th></th>
                <?php
            }
            ?>
        </tr>
    </tfoot>
</table>

<?php echo $this->_afterTableHTML; ?>

<script type="text/javascript">
    var anOpen_<?php echo $this->name ?> = [];
    var anOpen_<?php echo $this->name ?>Id = [];
    var anOpen_<?php echo $this->name ?>2 = [];
    var anOpen_<?php echo $this->name ?>2Id = [];
    
    // get visible columns
    $.fn.getColumnsShown = function(dTable)
    {
        vCols = new Array();

        $.each(dTable.fnSettings().aoColumns, function(c){
            if(dTable.fnSettings().aoColumns[c].bVisible == true){
                vCols = vCols.concat(c)
            }
        });

        return vCols;
    }
    
    var oTable_<?php echo $this->name ?>;
    
    $(document).ready(function() {
        $.datepicker.regional['fr'] = {
            clearText: 'Effacer', clearStatus: '',
            closeText: 'Fermer', closeStatus: 'Fermer sans modifier',
            prevText: '<Préc', prevStatus: 'Voir le mois précédent',
            nextText: 'Suiv>', nextStatus: 'Voir le mois suivant',
            currentText: 'Courant', currentStatus: 'Voir le mois courant',
            monthNames: ['Janvier','Février','Mars','Avril','Mai','Juin',
                'Juillet','Août','Septembre','Octobre','Novembre','Décembre'],
            monthNamesShort: ['Jan','Fév','Mar','Avr','Mai','Jun',
                'Jul','Aoû','Sep','Oct','Nov','Déc'],
            monthStatus: 'Voir un autre mois', yearStatus: 'Voir un autre année',
            weekHeader: 'Sm', weekStatus: '',
            dayNames: ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],
            dayNamesShort: ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],
            dayNamesMin: ['Di','Lu','Ma','Me','Je','Ve','Sa'],
            dayStatus: 'Utiliser DD comme premier jour de la semaine', dateStatus: 'Choisir le DD, MM d',
            dateFormat: 'dd/mm/yy', firstDay: 0, 
            initStatus: 'Choisir la date', isRTL: false
        };
        $.datepicker.setDefaults($.datepicker.regional['fr']);
<?php
if (isset($this->config["table"]["detail"]) && $this->config["table"]["detail"]) {
    ?>
                /* Details */
                function fnFormatDetails ( oTable_<?php echo $this->name ?>, nTr ) {
                    var aData = oTable_<?php echo $this->name ?>.fnGetData( nTr );
                    var sOut = '<div class="innerDetails">'+'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">';
    <?php
    if (is_array($details) && count($details) > 0)
        foreach ($details as $detail) {
            list($detailName, $detailId) = explode("|", $detail);
            ?>
                                    if(aData[<?php echo $detailId; ?>] != '')
                                    sOut += '<tr><td><?php echo $detailName; ?></td><td>'+aData[<?php echo $detailId; ?>]+'</td></tr>';

                                                                                                                                                                                                                                                                                                                                                                                                                                            
            <?php
        }
    ?>
                    sOut += '</table>';
                                                                                                                                                                                             
                    return sOut;
                }
                                            
                $('#tableau-<?php echo $this->name ?> tbody td img.detail').live( 'click', function () {
                    var nTr = $(this).parents('tr')[0];
                    var i = $.inArray( nTr, anOpen_<?php echo $this->name ?> );
                    if ( i === -1 ) {
                        /* Open this row */
                        this.src = "<?php echo $this->_imgPath; ?>details_close.png";
                        var odd="even";
                        if ($(nTr).hasClass("odd")) {
                            odd = "odd";
                        }
                        var nDetailsRow = oTable_<?php echo $this->name ?>.fnOpen( nTr, fnFormatDetails(oTable_<?php echo $this->name ?>, nTr), 'details-other' );

                        $('div.innerDetails', nDetailsRow).slideDown();
                        anOpen_<?php echo $this->name ?>.push( nTr );
                        anOpen_<?php echo $this->name ?>Id.push( $(nTr).attr("id") );
                        $(nDetailsRow).addClass(odd)
                        $("td", nDetailsRow).addClass("highlighted")
                        $(nDetailsRow).hover(function() {
                            var odd = "even";

                            if ($(nTr).hasClass("odd")) {
                                odd = "odd";
                            }
                            if ($(nTr).hasClass(odd)) {
                                $(nTr).find("td").addClass("highlighted")
                            }

                        },function() {
                            var odd = "even"
                            if ($(nTr).hasClass("odd")) {
                                odd = "odd";
                            }
                            if ($(nTr).hasClass(odd)) {
                                $(nTr).find("td").removeClass("highlighted")
                            }
                        })

                        $(".ajax-load", nDetailsRow).each(function() {
                            loadAjax($(this), $(nTr).attr("id"));
                        })

                        $(".ajax-click-load", nDetailsRow).each(function() {
                            $(this).bind('click', function() {
                                var j = $.inArray(this, anOpen_<?php echo $this->name ?>2);
                                if ( j === -1 ) {
                                    this.src = "<?php echo $this->_imgPath; ?>details_close.png";
                                    anOpen_<?php echo $this->name ?>2.push( this );
                                    anOpen_<?php echo $this->name ?>2Id.push( $(this).attr("id") );
                                    loadAjax($(this).parent().find(".ajax-on-click"), $(nTr).attr("id"));
                                    $(this).parent().find(".ajax-on-click").slideDown();
                                } else {
                                    this.src = "<?php echo $this->_imgPath; ?>details_open.png";
                                    anOpen_<?php echo $this->name ?>2.splice( j, 1 );
                                    anOpen_<?php echo $this->name ?>2Id.splice( j, 1 );
                                    $(this).parent().find(".ajax-on-click").slideUp();
                                }
                            });
                        });
                    }
                    else {
                        /* This row is already open - close it */
                        this.src = "<?php echo $this->_imgPath; ?>details_open.png";
                        $('div.innerDetails', $(nTr).next()[0]).slideUp( function () {
                            oTable_<?php echo $this->name ?>.fnClose( nTr );
                            anOpen_<?php echo $this->name ?>.splice( i, 1 );
                            anOpen_<?php echo $this->name ?>Id.splice( i, 1 );
                        } );
                    }

                });
                /* Fin détails */
    <?php
}
?>
        
        oTable_<?php echo $this->name ?> = $('#tableau-<?php echo $this->name ?>').dataTable({
<?php
if (isset($this->config["table"]["pagination"]) && !$this->config["table"]["pagination"]) {
    ?>
                    'bPaginate': false,
                    'iDisplayLength': -1,
    <?php
}

if (isset($this->config["table"]["info"]) && !$this->config["table"]["info"]) {
    ?>
                    'bInfo': false,
<?php } ?>
    
<?php if (isset($this->config["table"]["filter"]) && !$this->config["table"]["filter"]) { ?>
                'bFilter': false,
<?php } ?>
            'oLanguage': {
                "sProcessing": '',
                "sLengthMenu": "Montrer _MENU_ <?php echo $this->config["table"]["title_item"] ?><?php echo isset($this->config["table"]["suffix_plural"]) ? $this->config["table"]["suffix_plural"] : "s" ?> par page",
                "sZeroRecords": "Aucun<?php echo $this->config["table"]["suffix_genre"] ?> <?php echo $this->config["table"]["title_item"] ?> trouvé<?php echo $this->config["table"]["suffix_genre"] ?>",
                "sEmptyTable": "Pas de <?php echo $this->config["table"]["title_item"] ?>",
                "sInfo": "<?php echo $this->config["table"]["title_item"] ?><?php echo isset($this->config["table"]["suffix_plural"]) ? $this->config["table"]["suffix_plural"] : "s" ?> _START_ à  _END_ sur _TOTAL_ <?php echo $this->config["table"]["title_item"] ?><?php echo isset($this->config["table"]["suffix_plural"]) ? $this->config["table"]["suffix_plural"] : "s" ?>",
                "sInfoEmpty": "Aucun<?php echo $this->config["table"]["suffix_genre"] ?> <?php echo $this->config["table"]["title_item"] ?>",
                "sInfoFiltered": "(filtre sur _MAX_ <?php echo $this->config["table"]["title_item"] ?><?php echo isset($this->config["table"]["suffix_plural"]) ? $this->config["table"]["suffix_plural"] : "s" ?>)",
                "sInfoPostFix": "",
                "sSearch": "",
                "sUrl": "",
                "oPaginate": {
                    "sFirst": "",
                    "sPrevious": "",
                    "sNext": "",
                    "sLast": ""
                }
            },
            'aaSorting': [
<?php
$numCol = 0;
foreach ($this->config["columns"] as $column) {
    if (isset($column["show"]) && $column["show"]) {
        if (isset($column["default_sorting"]) && $column["default_sorting"]) {
            ?>
                                        [ <?php echo isset($this->config["table"]["detail"]) && $this->config["table"]["detail"] ? $numCol + 1 : $numCol; ?>, "<?php echo $column["default_sorting_direction"]; ?>" ],        
            <?php
        }

        $numCol++;
    }
}
?>
            ],
            'aoColumns': [
<?php
if (isset($this->config["table"]["detail"]) && $this->config["table"]["detail"])
    echo '{ "bSortable": false},';

$numCol = 0;
foreach ($this->config["columns"] as $column) {
    if (isset($column["show"]) && $column["show"]
            || isset($column["show_detail"]) && $column["show_detail"]
    ) {
        if (isset($column["show_detail"])
                && $column["show_detail"]
                && (!isset($column["show"]) || !$column["show"])
        ) {
            ?>
                                        { "bVisible":    false },
            <?php
        } elseif (isset($column["sorting"]) && $column["sorting"] === FALSE) {
            ?>
                                        { "bSortable": false},
            <?php
        } else {
            ?>
                                        null,
            <?php
        }

        $numCol++;
    }
}

if (isset($this->config["extra"]["deletable"]) && $this->config["extra"]["deletable"])
    echo '{ "bSortable": false},';

?>
            ],

            "fnPreDrawCallback": function() {
                var $overlay = $('<div class="loading-overlay"><div class="circle"></div><div class="circle1"></div></div>').hide()
                $("#tableau-<?php echo $this->name ?>_wrapper").prepend($overlay)
                var marginTop = $("#tableau-<?php echo $this->name ?>_wrapper").outerHeight() / 2 - 25
                $overlay.find(".circle").css({'margin-top' : marginTop + "px"})
                $overlay.fadeIn(500);
                return true;
            },
            'fnDrawCallback': function(a, b, c) {
                    $('div.loading-overlay').remove()
<?php
if (isset($this->config["table"]["detail"]) && $this->config["table"]["detail"]) {
    ?>
                        if(anOpen_<?php echo $this->name ?>Id) {
                            anOpen_<?php echo $this->name ?>Id2 = anOpen_<?php echo $this->name ?>Id;
                            anOpen_<?php echo $this->name ?>Id = []

                            for(id in anOpen_<?php echo $this->name ?>Id2) {
                                item = anOpen_<?php echo $this->name ?>Id2[id]
                                if($('#' + item + ' td:first img').length > 0) {
                                    $('#' + item + ' td:first img').click();
                                }
                            }
                        }
<?php } ?>
            },
            "fnServerData": function ( sSource, aoData, fnCallback ) {
                $.ajax( {
                    "dataType": 'json',
                    "type": "POST",
                    "url": sSource,
                    "data": aoData,
                    "success": function(data){
                    
                        for (i in data.bottomsValue) {
                            $('tfoot tr:last th', oTable).eq(i).html(data.bottomsValue[i])
                        }
                    
                        fnCallback(data);                    
                    }
                } );
            },
            'sDom': '<"H"TClfr>t<"F"ip>',
            'bJQueryUI': true,
            'bSortCellsTop': true,
            'bProcessing': true,
            'bServerSide': true,
            'oTableTools': {
                'sSwfPath': "/back/swf/datatable/copy_cvs_xls_pdf.swf",
                'aButtons': [
<?php
if (isset($this->config["extra"]) && isset($this->config["extra"]["copy"]) && $this->config["extra"]["copy"]) {
    ?>
                            {
                                'sExtends':    "collection",
                                'sButtonText': "Copier",
                                'aButtons': [  
                                    {
                                        'sExtends': "copy",
                                        'sButtonText': "Colonnes visibles",
                                        'sCharSet': "utf8",
                                        'mColumns': "visible"
                                    },
                                    {
                                        'sExtends': "copy",
                                        'sButtonText': "Toutes colonnes",
                                        'sCharSet': "utf8",
                                        'mColumns': "all"
                                    }
                                ]
                            },
    <?php
}

if (isset($this->config["extra"]) && isset($this->config["extra"]["print"]) && $this->config["extra"]["print"]) {
    ?>
                            {
                                "sExtends": "print",
                                "sButtonText": "Imprimer",
                                "sCharSet": "utf8",
                                "mColumns": "all"
                            },
    <?php
}

if (isset($this->config["extra"]) && isset($this->config["extra"]["pdf"]) && $this->config["extra"]["pdf"]) {
    ?>
                            {
                                "sExtends":    "collection",
                                "sButtonText": "PDF",
                                "aButtons":    [  
                                    {
                                        "sExtends": "pdf",
                                        "sButtonText": "Colonnes visibles",
                                        "sPdfOrientation": "landscape",
                                        "sCharSet": "utf8",
                                        "mColumns": "visible"
                                    },
                                    {
                                        "sExtends": "pdf",
                                        "sButtonText": "Toutes colonnes",
                                        "sPdfOrientation": "landscape",
                                        "sCharSet": "utf8",
                                        "mColumns": "all"
                                    }
                                ]
                            },
    <?php
}

if (isset($this->config["extra"]) && isset($this->config["extra"]["csv"]) && $this->config["extra"]["csv"]) {
    ?>
                            {
                                "sExtends":    "collection",
                                "sButtonText": "CSV",
                                "aButtons":    [  
                                    {
                                        "sExtends": "csv",
                                        "sButtonText": "Colonnes visibles",
                                        "sCharSet": "utf8",
                                        "mColumns": "visible"
                                    },
                                    {
                                        "sExtends": "csv",
                                        "sButtonText": "Toutes colonnes",
                                        "sCharSet": "utf8",
                                        "mColumns": "all"
                                    }
                                ]
                            },
    <?php
}
?>
                ]
            },
<?php
if (isset($this->config["extra"]) && isset($this->config["extra"]["hide_columns"]) && $this->config["extra"]["hide_columns"]) {
    ?>
                    "oColVis": {
    <?php
    if (isset($this->config["table"]["detail"]) && $this->config["table"]["detail"])
        echo ' "aiExclude": [ 0 ],';
    ?>
                        "buttonText": "Cacher des colonnes"
                    },
    <?php
}
?>
            "sAjaxSource": "<?php echo $this->url; ?><?php echo strpos($this->url, "?") === false ? '?' : '&' ?>json&<?php echo $this->additionalParams ?>",
            "sServerMethod": "POST"
            
        }).columnFilter({
<?php
if (isset($this->config["extra"]) && isset($this->config["extra"]["hide_columns"]) && $this->config["extra"]["hide_columns"]) {
    ?>
                    'bUseColVis': true,
    <?php
}
?>

            'aoColumns': [ 
<?php
if (isset($this->config["table"]["detail"]) && $this->config["table"]["detail"])
    echo ' null,';

$numCol = 0;
foreach ($this->config["columns"] as $column) {
    if (isset($column["show"]) && $column["show"] || isset($column["show_detail"]) && $column["show_detail"]) {
        if (!isset($column["filter_field"])) {
            ?>
                                        null,
            <?php
        } elseif ($column["filter_field"] == "text") {
            ?>
                                        {'type': "text"},
            <?php
        } elseif ($column["filter_field"] == "date-range") {
            ?>
                                        {'type': "date-range", 'pastonly' : <?php echo isset($column["filter_field_date_past"]) && $column["filter_field_date_past"] ? 'true' : 'false'; ?>, 'defaultvalues' : <?php echo isset($column["filter_field_default"]) && is_array($column["filter_field_default"]) ? json_encode($column["filter_field_default"]) : 'false'; ?>},
            <?php
        } elseif ($column["filter_field"] == "select") {
            ?>
                                        {'type': "select", 'values' : <?php echo json_encode($column["values"]); ?>},
            <?php
        }
        $numCol++;
    }
}
?> 
            ]
        });
    
        $('.dataTables_filter input').attr("placeholder", "Recherche...");
    
        $('td', oTable_<?php echo $this->name ?>.fnGetNodes()).livequery(function(){
            $(this).hover(function() {
                var odd = "even"
                if ($(this).parent().hasClass("odd")) {
                    odd = "odd";
                }
                if ($(this).parent().next().hasClass(odd)) {
                    $(this).parent().next().find(" > td").addClass("highlighted")
                }
            },function() {
                var odd = "even"
                if ($(this).parent().hasClass("odd")) {
                    odd = "odd";
                }
                if ($(this).parent().next().hasClass(odd)) {
                    $(this).parent().next().find("td").removeClass("highlighted")
                }
            });
        
            if(!$("#tableau-<?php echo $this->name ?> thead tr th").eq($(this).index()).hasClass("editable"))
            return true;
            
            /* Apply the jEditable handlers to the table */
            var type = $("#tableau-<?php echo $this->name ?> thead tr th").eq($(this).index()).hasClass("editable-textarea") ? 'textarea' : "text" ;
            var type = $("#tableau-<?php echo $this->name ?> thead tr th").eq($(this).index()).hasClass("editable-autogrow") ? 'autogrow' : "text" ;
            $(this).editable( '<?php echo $this->url; ?><?php echo strpos($this->url, "?") === false ? '?' : '&' ?>editable&<?php echo $this->additionalParams ?>'  , {
                type      : type,
                br2nl      : $("#tableau-<?php echo $this->name ?> thead tr th").eq($(this).index()).hasClass("editable-br2nl") ? true : false ,
                cancel    : type != "text" ? 'Annuler' : null ,
                submit    : type != "text" ? 'Enregistrer' : null ,
                indicator : 'Sauvegarde en cours ...',
                placeholder   : 'Cliquer pour éditer ...',
                tooltip :  'Cliquer pour éditer ...',
                "callback": function( sValue, y ) {
                    var aPos = oTable_<?php echo $this->name ?>.fnGetPosition( this );
                    oTable_<?php echo $this->name ?>.fnUpdate( sValue, aPos[0], aPos[1]);
                },
                data: function(value, settings) {
                    /* Convert <br> to newline. */
                    var retval = value;
                    if(settings.br2nl)
                        var retval = value.br2nl();

                    return retval;
                },
                "submitdata": function ( value, settings ) {
                    return {
                        "row_id": this.parentNode.getAttribute('id'),
                        "column": oTable_<?php echo $this->name ?>.fnGetPosition( this )[2]
                    };
                },
                "width" : "100%",
                "onblur"    : type != "text" ? "ignore" : null,
                "height": type == "textarea" ? '100px' : "14px"
            } );
        
        });

<?php
if (isset($this->config["table"]["fixedheader"]) && $this->config["table"]["fixedheader"]) {
    ?>
                new FixedHeader( oTable_<?php echo $this->name ?>, { "bottom": false } );
    <?php
}
?>
        
    });

    function loadAjax($elem, id) {
        var filter = $elem.attr("data-filter")
        filter = filter.replace("[INDEX]", id)
        var url = $elem.attr("rel") + "&" + filter;
        $elem.load(url)
    }

            
    // Convert HTML breaks to newline
    String.prototype.br2nl =
        function() {
        return this.replace(/<br\s*\/?>/mg,"\n");
    };
    
</script>

<?php
if (!isset($_GET["nojs"]) || !$_GET["nojs"]) {
    echo '
            ' . $this->_css . '
            ' . $this->_javascript;
}
?>
